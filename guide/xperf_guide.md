## Руководство по работе с Xperf

- Установите Xperf при помощи [adksetup](https://learn.microsoft.com/en-us/windows-hardware/get-started/adk-install)

	- Установите Windows Perfomance Toolkit 

- Скачайте скрипт [xperf-dpcisr.bat](https://github.com/Seniroad/Computer-RU-Setup-guide/blob/main/files/xperf-test-script.bat)

- Запустите скрипт

- Откройте файл report.txt или файл трейса (.etl) для более расширенного просмотра (в этом гайде не будет части для .etl, так как для 90% читателей это ненужная информация)


## Объяснение

- Время выполнения DPC или прерывания в компьютере измеряется в us (Микросекундах), так что это не миллисекунды, как вы могли видеть в плацебных программах.

- ```CPU Usage from 0 us to ХХХХХХХ us``` - общее время нагрузки ЦП

- ```CPU 0 Usage,      CPU 1 Usage,      CPU 2 Usage  и т.д.``` - Указания ядра для столбца 
	
	- Учитывайте HT и CCD/CCX
	
	- отсчет начинается не с 1, а с 0 ядра
		
		- т.е. 0 ядро(поток) это 1 ядро(поток)

- ```Module``` (CLASSPNP.SYS, Wdf01000.sys, dxgkrnl.sys и другие) - То, что создает DPC или прерывания

- ```0 usecs AND <=  1 usecs``` - 0 микросекунд и меньше 1 микросекунды

	- То есть эта операция занимает время в районе от 0-1 микросекунды (включительно)

- ```Total = 4107``` - Всего DPC/прерываний от модуля


## Главное

> [!IMPORTANT]
> Все DPC и прерывания, при включенном HT должны выполняться на первом одном потоке (то есть для модуля на ядре 6 при включенном HT это будет 10 и 11 поток, значит модуль должен выполняться только на 10 потоке).
> Для CCD учитывайте, где работает игра (то есть если у вас игра работает на первом CCD, то на первый CCD и ставьте модуль).

- DPC и прерывания модуля должны быть на одном ядре.

- DPC и прерывания должны быть распределены по ядрам и не пересекаться между собой.

- Исключением может быть только SATA или PCI интерфейс SSD, обычно он должен распределятся на все ядра.